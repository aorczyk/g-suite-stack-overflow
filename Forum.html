<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bulma -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css">
  <!-- Fontawesome -->
  <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
  <!-- Vue -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <!--<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>-->
  <!-- Vue router -->
  <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>

  <!-- Quill Editor-->
  <!-- Include the Quill library -->
  <script src="https://cdn.quilljs.com/1.3.4/quill.js"></script>
  <!-- Quill JS Vue -->
  <script src="https://cdn.jsdelivr.net/npm/vue-quill-editor@3.0.4/dist/vue-quill-editor.js"></script>
  <!-- Include stylesheet -->
  <link href="https://cdn.quilljs.com/1.3.4/quill.core.css" rel="stylesheet">
  <link href="https://cdn.quilljs.com/1.3.4/quill.snow.css" rel="stylesheet">
  <link href="https://cdn.quilljs.com/1.3.4/quill.bubble.css" rel="stylesheet">

  <!-- Style -->
  <style><?!= include('style.html'); ?></style>
</head>

<body>
  <div id="app">
    <top-bar></top-bar>
    <router-view :user="user"></router-view>
  </div>

  <script>
    var dataFromServer = <?!= JSON.stringify(dataFromServerTemplate) ?>;
    console.log(dataFromServer);
  </script>

  <?!= include('vue_questions.html'); ?>
  <?!= include('vue_question.html'); ?>
  <?!= include('vue_forum.html'); ?>
  <?!= include('vue_topbar.html'); ?>
  <?!= include('vue_utils.html'); ?>
  <?!= include('vue_quill.html'); ?>
  <?!= include('vue_routes.html'); ?>
  <?!= include('vue_store.html'); ?>

  <script>
    // TODO: quill image loader
    // https://stackoverflow.com/questions/43857373/quill-editor-vuejs2-image-upload-base64-image-to-url

    var app = new Vue({
      el: '#app',
      router: router,
      data: {
        router: router,
        user: dataFromServer.user,
      },
      created: function () {
        // Router - Get the path from the string URL fragment appearing after the '#' character.
        google.script.url.getLocation(function(location) {
          var path = location.hash;
          if (path){
            router.push(path);
          }

          self.locationLoaded = true;
        });
      },
      watch: {
        // Router - Watching router's current route.
        'router.currentRoute.path' () {
           var path = router.currentRoute.path;
           var now = new Date();
           var state = {
             'timestamp': now.getTime()
           };
           google.script.history.push(state, {}, path);
        }
      },
      methods: {
      }
    })
  </script>
</body>

</html>