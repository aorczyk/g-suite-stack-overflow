<!DOCTYPE html>
<html class="has-navbar-fixed-top">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bulma -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css">
  <!-- Fontawesome -->
  <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
  <!-- Vue -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> -->
  <!-- The latest version -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
  <!-- Vue router -->
  <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>

  <!-- Quill Editor-->
  <!-- Include the Quill library -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <!-- Quill JS Vue -->
  <script src="https://cdn.jsdelivr.net/npm/vue-quill-editor@3.0.4/dist/vue-quill-editor.js"></script>
  <!-- Include stylesheet -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

  <script src="https://unpkg.com/vue-i18n/dist/vue-i18n.js"></script>

  <!-- Style -->
  <style><?!= include('style.html'); ?></style>
</head>

<body>
  <div id="app">
    <spinner v-if="sharedState.isSpinnerVisible"></spinner>
    <top-bar></top-bar>
    <router-view></router-view>
  </div>

  <script>
    var dataFromServer = <?!= JSON.stringify(dataFromServerTemplate) ?>;
  </script>

  <?!= include('vue_utils.html'); ?>
  <?!= include('vue_store.html'); ?>
  <?!= include('vue_new_question.html'); ?>
  <?!= include('vue_new_forum.html'); ?>
  <?!= include('vue_forums.html'); ?>
  <?!= include('vue_questions.html'); ?>
  <?!= include('vue_question.html'); ?>
  <?!= include('vue_forum.html'); ?>
  <?!= include('vue_topbar.html'); ?>
  <?!= include('vue_quill.html'); ?>
  <?!= include('vue_routes.html'); ?>

  <script>
    const messages = {
      en: {
        message: {
          askQuestion: 'Ask Question',
          addNewForum: 'Add New Forum',
          forums: 'Forums',
          search: 'Search',
          newForum: 'New forum',
          editForum: 'Edit forum',
          name: 'Name',
          description: 'Description',
          isPublic: 'Is public',
          users: 'Users (comma separated users emails)',
          moderators: 'Moderators (comma separated users emails)',
          admins: 'Admins (comma separated users emails)',
          save: 'Save',
          cancel: 'Cancel',
          filter: 'Filter',
          questions: 'Questions',
          votes: 'votes',
          answers: 'answers',
          answers2: 'Answers',
          views: 'views',
          lastChange: 'Last change',
          noQuestions: 'No Questions',
          title: 'Title',
          body: 'Body',
          newQuestionTitleInfo: 'Be specific and imagine you’re asking a question to another person',
          newQuestionBodyInfo: 'Include all the information someone would need to answer your question',
          edit: 'Edit',
          edit2: 'edit',
          backToQuestions: 'Back To Questions',
          startWatching: 'Start watching',
          stopWatching: 'Stop watching',
          addWatcher: 'Add watcher',
          enterEmail: 'Enter email',
          bestAns: 'The question owner accepted this as the best answer',
          goodAns: 'This answers is useful',
          badAns: 'This answers is not useful',
          addAcomment: 'add a comment',
          yourAnswer: 'Your Answer',
          postYourAnswer: 'Post Your Answer',
          deleted: 'Deleted',
          AskApublicQuestion: 'Ask a public question',
          edited: 'Edited'
        }
      },
      pl: {
        message: {
          askQuestion: 'Nowe pytanie',
          forums: 'Fora',
          search: 'Szukaj',
          name: 'Nazwa',
          bestAns: 'Zadający pytanie uważa, że ta odpowiedź jest najlepsza',
          goodAns: 'Pytanie jest przydatne',
          badAns: 'Pytanie nie jest przydatne',
          addNewForum: 'Nowe Forum',
          newForum: 'Nowe forum',
          editForum: 'Edycja forum',
          description: 'Opis',
          isPublic: 'Publiczne',
          users: 'Użytkownicy (adresy e-mail oddzielone przecinkami)',
          moderators: 'Moderatorzy (adresy e-mail oddzielone przecinkami)',
          admins: 'Administratorzy (adresy e-mail oddzielone przecinkami)',
          save: 'Zapisz',
          cancel: 'Anuluj',
          filter: 'Filtr',
          questions: 'Pytania',
          votes: 'głosów',
          answers: 'odpowiedzi',
          answers2: 'Odpowiedzi',
          views: 'wejść',
          lastChange: 'Ostatnia zmiana',
          noQuestions: 'Brak odpowiedzi',
          title: 'Tytuł',
          body: 'Treść',
          newQuestionTitleInfo: 'Bądź dokłady, wyobraź sobie, że zadajesz pytanie innej osobie',
          newQuestionBodyInfo: 'Zamieść wszystkie informacje, które pomogą udzielić odpowiedzi na twoje pytanie',
          edit: 'Edycja',
          edit2: 'edycja',
          backToQuestions: 'Powrót do listy pytań',
          startWatching: 'Zacznij obserwowanie',
          stopWatching: 'Zakończ obserwowanie',
          addWatcher: 'Dodaj obserwatora',
          enterEmail: 'Podaj e-mail',
          addAcomment: 'dodaj komentarz',
          yourAnswer: 'Twoja odpowiedź',
          postYourAnswer: 'Prześlij swoją odpowiedź',
          deleted: 'Usunięte',
          AskApublicQuestion: 'Zadaj publiczne pytanie',
          edited: 'Edytowane'
        }
      }
    }

    const i18n = new VueI18n({
      locale: 'en',
      messages,
    });

    var app = new Vue({
      i18n,
      el: '#app',
      router: router,
      data: {
        sharedState: store.state,
        router: router,
      },
      created: function () {
        // Router - Get the path from the string URL fragment appearing after the '#' character.
        google.script.url.getLocation(function(location) {
          var path = location.hash;

          if (! path || path == '/'){
            router.push('/forums');
          } else {
            router.push(path);
          }
        });
      },
      watch: {
        // Router - Watching router's current route.
        'router.currentRoute.path' () {
           var path = router.currentRoute.path;
           var now = new Date();
           var state = {
             'timestamp': now.getTime()
           };
           google.script.history.push(state, {}, path);
        }
      }
    })
  </script>
</body>

</html>