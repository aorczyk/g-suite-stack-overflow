<script>

  var store = {
    debug: true,
    state: {
      user: dataFromServer.user,
      forum: null,
      isSpinnerVisible: false,
      searched: null,
      searchText: ''
    },
    setForum(newValue) {
      if (this.debug) console.log('setForum triggered with', newValue)
      this.state.forum = newValue
    },
    search(){
      if (!this.state.searchText){
        this.state.searched = null;
      }

      console.log('search')
      var reg = new RegExp(this.state.searchText, 'i');
      this.state.isSpinnerVisible = true;

      this.state.searched = this.state.forum.questions.filter((x)=>{
        return x.title.search(reg) != -1 || x.body.search(reg) != -1;
      }).map((x)=>{return x.id});

      console.log(this.state.forum)

      for (var entity of ['answers', 'comments']){
        for (var id in this.state.forum[entity]){
          for (var item of this.state.forum[entity][id]){
            if (item.body && item.body.search(reg) != -1){
              this.state.searched.push(item.qId);
            }
          }
        }
      }

      this.state.isSpinnerVisible = false;

      if (router.currentRoute.path != `/${this.state.forum.id}`){
        router.push(`/${this.state.forum.id}`);
      }
    }
  };
</script>